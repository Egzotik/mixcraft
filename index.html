<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–∞—Ñ—Ç–æ–≤ Minecraft</title>
  <link rel="icon" href="https://minecraft.mix-servers.com/assets/main/img/favicon.ico" />
  <style>

    #modal-img {
      border: 2px solid #ffffff;
      border-radius: 6px;
      background-color: #1e1f22;
      padding: 4px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #2b2d31;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding: 0 20px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
    }

    header {
      width: 100%;
      background-color: #313338;
      padding: 16px 0;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    header img {
      height: 48px;
    }

    main {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      gap: 40px;
      width: 100%;
      max-width: 1400px;
      flex-wrap: wrap;
    }

    .grid-container, .selection-container {
      background: #313338;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 0 24px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      width: 640px;
    }

    #search-container {
      width: 100%;
      text-align: center;
      margin-bottom: 16px;
    }

    #search-input {
      width: 80%;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid #444;
      background: #1e1f22;
      color: white;
      font-size: 14px;
    }

    #autocomplete-list {
      background-color: #232428;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.7);
      z-index: 1000;
      margin-top: 4px;
      position: absolute;
      width: 80%;
      left: 10%;
    }

    .autocomplete-item {
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.15s ease;
      font-size: 14px;
    }

    .autocomplete-item:hover {
      background-color: #5865f2;
      color: white;
    }

    .autocomplete-item img {
      width: 24px;
      height: 24px;
      border-radius: 4px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(8, 64px);
      gap: 12px;
      justify-content: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–µ—Ç–∫—É */
    }

    .grid-item {
      width: 64px;
      height: 64px;
      background-color: #1e1f22;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
      position: relative;
      user-select: none;
    }

    .grid-item:hover {
      transform: scale(1.05);
    }

    .grid-item img {
      max-width: 48px;
      max-height: 48px;
      pointer-events: none;
    }

    .clear-btn {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      align-self: center;
      transition: background-color 0.2s ease;
      margin-top: 16px;   /* ‚Üê –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      margin-bottom: 16px; /* ‚Üê –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
    }

    .clear-btn:hover {
      background-color: #ff4d4d;
    }

    #result {
      background: #232428;
      padding: 16px;
      border-radius: 8px;
      font-size: 14px;
      user-select: none;
      white-space: normal;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .selected-item {
      background: #232428;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }

    .selected-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .selected-item-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-grow: 1;
    }

    .selected-item img {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #888;
      padding: 2px;
      background-color: #2b2d31;
    }

    .selected-item input {
      width: 50px;
      background: #1e1f22;
      border: 1px solid #444;
      color: #fff;
      padding: 4px;
      text-align: center;
      border-radius: 6px;
      font-size: 14px;
    }

    .remove-btn {
      background: none;
      border: none;
      color: #ff6b6b;
      font-size: 18px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .remove-btn:hover {
      color: #ff4d4d;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      background: #313338;
      padding: 24px 32px;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: center;
      min-width: 320px;
      max-width: 90vw;
      user-select: none;
    }

    .modal-content img {
      max-width: 64px;
      max-height: 64px;
    }

    .craft-grid {
      display: grid;
      grid-template-columns: repeat(3, 44px);
      grid-template-rows: repeat(3, 44px);
      gap: 6px;
      margin-top: 12px;
      justify-content: center;
    }

    .craft-cell {
      background: #1e1f22;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .craft-cell img {
      max-width: 40px;
      max-height: 40px;
    }

    .modal-content button {
      background-color: #ff6b6b;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }

    .modal-content button:hover {
      background-color: #ff4d4d;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
        align-items: center;
        gap: 24px;
      }

      .grid-container, .selection-container {
        width: 100%;
        max-width: 100%;
      }

      #search-input {
        width: 90%;
        font-size: 13px;
        padding: 8px 10px;
      }

      .grid {
        grid-template-columns: repeat(auto-fit, minmax(48px, 1fr));
        gap: 8px;
      }

      .grid-item {
        width: 48px;
        height: 48px;
      }

      .grid-item img {
        max-width: 36px;
        max-height: 36px;
      }

      .selected-item img {
        width: 28px;
        height: 28px;
      }

      .selected-item input {
        width: 40px;
        font-size: 13px;
      }

      #result {
        font-size: 13px;
      }

      .modal-content {
        padding: 16px 20px;
      }

      .modal-content img {
        max-width: 48px;
        max-height: 48px;
      }

      .craft-cell {
        width: 40px;
        height: 40px;
      }

      .craft-cell img {
        max-width: 32px;
        max-height: 32px;
      }

      .modal-content button {
        padding: 6px 12px;
        font-size: 13px;
      }
    }
      #selected-list-wrapper {
        max-height: 150px;
        overflow-y: auto;
        padding-right: 4px; /* —á—Ç–æ–±—ã —Å–∫—Ä–æ–ª–ª –Ω–µ —Å–¥–≤–∏–≥–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç */
      }

      #selected-list-wrapper::-webkit-scrollbar {
        width: 6px;
      }
      #selected-list-wrapper::-webkit-scrollbar-thumb {
        background-color: #555;
        border-radius: 4px;
      }
      #selected-list-wrapper::-webkit-scrollbar-track {
        background: transparent;
      }

  </style>
  <script src="craft.js"></script>
</head>
<body>

  <header>
    <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø">
  </header>

  <main>
    <div class="grid-container">
      <div id="search-container">
        <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫..." autocomplete="off">
        <div id="autocomplete-list" hidden></div>
      </div>
      <div class="grid" id="item-grid"></div>
    </div>
    <div class="selection-container">

      <div id="selected-list-wrapper">
        <div id="selected-list"></div>
      </div>
      <button id="clear-selection" class="clear-btn">üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
      <div id="result">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤</div>
    </div>


  <div class="modal" id="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <img id="modal-img" src="" alt="–ò–∫–æ–Ω–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–∞" />
      <div id="modal-craft" class="craft-grid"></div>
    </div>
  </div>

</body>

    <script>
      const BASE_RESOURCES = ['30188', '30244']; // –¥–æ–±–∞–≤–ª—è–π –Ω—É–∂–Ω—ã–µ id
      const selectedItems = [];
      const searchInput = document.getElementById('search-input');
      const autocompleteList = document.getElementById('autocomplete-list');
      const itemGrid = document.getElementById('item-grid');
      const selectedList = document.getElementById('selected-list');
      const resultDiv = document.getElementById('result');
      const modal = document.getElementById('modal');
      const modalImg = document.getElementById('modal-img');
      const modalCraft = document.getElementById('modal-craft');

      // –ù–∞–≤–µ—Å–∏–º —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ç–∞–±—ã

      function addToSelection(id) {
        const existing = selectedItems.find(item => item.id === id);
        if (existing) {
          existing.count++;
        } else {
          selectedItems.push({ id, count: 1 });
        }
        renderSelectedList();
        calculateResources();
      }

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–∏—Å–∫–∞
      function renderItemGrid() {
        itemGrid.innerHTML = '';
        const searchValue = searchInput.value.toLowerCase();

        const filtered = crafts
          .filter(craft => !craft.hidden)
          .filter(craft => craft.name.toLowerCase().includes(searchValue));

        filtered.forEach(craft => {
          const div = document.createElement('div');
          div.className = 'grid-item';
          div.title = craft.name;

          const img = document.createElement('img');
          img.src = craft.img || 'https://via.placeholder.com/48';
          img.alt = craft.name;

          div.appendChild(img);
          

          // –ï—Å–ª–∏ outputQuantity –±–æ–ª—å—à–µ 1 ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–π —Å—á–µ—Ç—á–∏–∫ —Ä—è–¥–æ–º —Å –∏–∫–æ–Ω–∫–æ–π
          if (craft.outputQuantity && craft.outputQuantity > 1) {
            const qtyBadge = document.createElement('div');
            qtyBadge.textContent = craft.outputQuantity;
            qtyBadge.style.position = 'absolute';
            qtyBadge.style.bottom = '4px';
            qtyBadge.style.right = '4px';
            qtyBadge.style.background = 'rgba(0,0,0,0.6)';
            qtyBadge.style.color = 'white';
            qtyBadge.style.fontSize = '11px';
            qtyBadge.style.padding = '1px 4px';
            qtyBadge.style.borderRadius = '6px';
            qtyBadge.style.pointerEvents = 'none';
            qtyBadge.style.userSelect = 'none';

            div.style.position = 'relative'; // –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            div.appendChild(qtyBadge);
          }

          div.onclick = () => addToSelection(craft.id);

          itemGrid.appendChild(div);
        });

        if (filtered.length === 0) {
          itemGrid.innerHTML = '<p style="color:#999; grid-column: span 4;">–ü—Ä–µ–¥–º–µ—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
        }
      }

      function renderSelectedList() {
        selectedList.innerHTML = '';
        if (selectedItems.length === 0) {
          selectedList.innerHTML = '<p style="color:#999; text-align: center; padding: 12px 0;">–ù–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤</p>';
          resultDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤';
          return;
        }
      document.getElementById('clear-selection').addEventListener('click', () => {
        selectedItems.length = 0;
        renderSelectedList();
        calculateResources();
      }); 
        const tip = document.createElement('p');
        tip.textContent = 'üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ—Ü–µ–ø—Ç –∫—Ä–∞—Ñ—Ç–∞';
        tip.style.color = '#ccc';
        tip.style.fontSize = '13px';
        tip.style.textAlign = 'center';
        tip.style.marginBottom = '8px';
        selectedList.appendChild(tip);


        selectedItems.forEach(({ id, count }) => {
          const craft = crafts.find(c => c.id === id);
          if (!craft) return;

          const div = document.createElement('div');
          div.className = 'selected-item';

          const header = document.createElement('div');
          header.className = 'selected-item-header';

          const info = document.createElement('div');
          info.className = 'selected-item-info';

          const img = document.createElement('img');
          img.src = craft.img || 'https://via.placeholder.com/32';
          img.alt = craft.name;
          img.title = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç –∫—Ä–∞—Ñ—Ç–∞';
          img.onclick = () => showCraftModal(craft);

          const nameSpan = document.createElement('span');
          nameSpan.textContent = craft.name;

          info.appendChild(img);
          info.appendChild(nameSpan);

          const countInput = document.createElement('input');
          countInput.type = 'number';
          countInput.min = 1;
          countInput.step = 1;
          countInput.value = count;
          countInput.title = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∞—Ñ—Ç–æ–≤ (—à–∞–≥–æ–≤)';
          countInput.onchange = (e) => {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 1) {
              val = 1;
            }
            e.target.value = val;
            selectedItems.find(i => i.id === id).count = val;
            renderSelectedList(); // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤
            calculateResources();
          };

          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-btn';
          removeBtn.title = '–£–¥–∞–ª–∏—Ç—å';
          removeBtn.textContent = '√ó';
          removeBtn.onclick = () => {
            const idx = selectedItems.findIndex(i => i.id === id);
            if (idx !== -1) {
              selectedItems.splice(idx, 1);
              renderSelectedList();
              calculateResources();
            }
          };

          header.appendChild(info);
          header.appendChild(countInput);
          header.appendChild(removeBtn);
          div.appendChild(header);
          selectedList.appendChild(div);
        });
      }

          // –†–∞—Å—Å—á—ë—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ —Å —É—á—ë—Ç–æ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫—Ä–∞—Ñ—Ç–æ–≤
    function calculateResources() {
      if (selectedItems.length === 0) {
        resultDiv.innerHTML = '<p style="color:#999;">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤.</p>';
        return;
      }

      resultDiv.innerHTML = '';

      let matterTotal = 0;
      const leftovers = {};
      const resourcesCount = {};
      const baseResources = {};
      const selectedSet = new Set(selectedItems.map(i => i.id));

      function accumulate(craft, quantity, isRoot = false) {
        const output = craft.outputQuantity || 1;
        const craftCount = Math.ceil(quantity / output);
        const totalOutput = craftCount * output;
        const extra = totalOutput - quantity;

        if (extra > 0 && !isRoot) {
          leftovers[craft.id] = (leftovers[craft.id] || 0) + extra;
        }

        if (craft.components) {
          craft.components.forEach(component => {
            if (BASE_RESOURCES.includes(component.id)) {
              baseResources[component.id] = (baseResources[component.id] || 0) + component.count * craftCount;
              return;
            }

            const subCraft = crafts.find(c => c.id === component.id);
            if (subCraft) {
              accumulate(subCraft, component.count * craftCount);
            } else {
              resourcesCount[component.id] = (resourcesCount[component.id] || 0) + component.count * craftCount;
            }
          });
        }

        if (!isRoot) {
          resourcesCount[craft.id] = (resourcesCount[craft.id] || 0) + quantity;
        }
      }

      selectedItems.forEach(({ id, count }) => {
        const craft = crafts.find(c => c.id === id);
        if (!craft) return;
        accumulate(craft, count, true);
      });

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–î–ª—è –∫—Ä–∞—Ñ—Ç–∞ –Ω–∞–¥–æ"
      const baseTitle = document.createElement('p');
      baseTitle.style.marginBottom = '8px';
      baseTitle.style.color = '#ffde59';
      baseTitle.style.fontWeight = 'bold';
      baseTitle.innerHTML = '–î–ª—è –∫—Ä–∞—Ñ—Ç–∞ –Ω–∞–¥–æ:';
      resultDiv.appendChild(baseTitle);

      // –ú–∞—Ç–µ—Ä–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (matterTotal > 0) {
        const matterInfo = document.createElement('p');
        matterInfo.style.color = '#ff59d6';
        matterInfo.innerHTML = `
          <img src="https://ru.minecraft.wiki/images/%D0%9C%D0%B0%D1%82%D0%B5%D1%80%D0%B8%D1%8F_%28IndustrialCraft_2%29.png?518e5" 
          alt="–ú–∞—Ç–µ—Ä–∏—è" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 6px;">
          –ú–∞—Ç–µ—Ä–∏—è: <b>${matterTotal}</b>
        `;
        resultDiv.appendChild(matterInfo);
      }

      // –°–ø–∏—Å–æ–∫ –±–∞–∑–æ–≤—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
      if (Object.keys(baseResources).length > 0) {
        const ul = document.createElement('ul');
        ul.style.listStyle = 'none';
        ul.style.paddingLeft = '20px';

        for (const [id, qty] of Object.entries(baseResources)) {
          const craft = crafts.find(c => c.id === id);
          if (!craft) continue;

          const li = document.createElement('li');
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          li.style.gap = '6px';

          const img = document.createElement('img');
          img.src = craft.img || 'https://via.placeholder.com/20';
          img.style.width = '20px';
          img.style.height = '20px';
          img.style.borderRadius = '4px';

          const text = document.createElement('span');
          text.textContent = `${craft.name} √ó ${qty}`;

          li.appendChild(img);
          li.appendChild(text);
          ul.appendChild(li);
        }

        resultDiv.appendChild(ul);
      }

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã:"
      const title = document.createElement('h3');
      title.textContent = 'üìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã:';
      title.style.marginTop = '16px';
      title.style.marginBottom = '10px';
      title.style.fontSize = '16px';
      title.style.color = '#ffffff';
      title.style.fontWeight = '600';
      resultDiv.appendChild(title);

      // –û—Å–Ω–æ–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤
      const tree = document.createElement('ul');
      tree.style.listStyle = 'none';
      tree.style.paddingLeft = '0';

      for (const [id, qty] of Object.entries(resourcesCount)) {
        const craft = crafts.find(c => c.id === id);
        if (!craft || qty <= 0) continue;

        const li = document.createElement('li');
        li.style.display = 'flex';
        li.style.alignItems = 'center';
        li.style.gap = '6px';

        const img = document.createElement('img');
        img.src = craft.img || 'https://via.placeholder.com/20';
        img.alt = craft.name;
        img.style.width = '20px';
        img.style.height = '20px';
        img.style.borderRadius = '4px';

        const span = document.createElement('span');
        span.textContent = `${craft.name} √ó ${qty}`;

        li.appendChild(img);
        li.appendChild(span);
        tree.appendChild(li);
      }

      if (tree.children.length > 0) {
        resultDiv.appendChild(tree);
      }

      // –û—Å—Ç–∞—Ç–∫–∏
      if (Object.keys(leftovers).length > 0) {
        const leftoverTitle = document.createElement('p');
        leftoverTitle.innerHTML = 'üì¶ –û—Å—Ç–∞—Ç–∫–∏ –ø–æ—Å–ª–µ –∫—Ä–∞—Ñ—Ç–∞:';
        leftoverTitle.style.marginTop = '12px';
        leftoverTitle.style.fontWeight = 'bold';
        resultDiv.appendChild(leftoverTitle);

        const ul = document.createElement('ul');
        ul.style.listStyle = 'none';
        ul.style.paddingLeft = '20px';

        for (const [id, qty] of Object.entries(leftovers)) {
          const craft = crafts.find(c => c.id === id);
          if (!craft) continue;

          const li = document.createElement('li');
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          li.style.gap = '6px';

          const img = document.createElement('img');
          img.src = craft.img || 'https://via.placeholder.com/20';
          img.style.width = '20px';
          img.style.height = '20px';
          img.style.borderRadius = '4px';

          const text = document.createElement('span');
          text.textContent = `${craft.name}: +${qty}`;

          li.appendChild(img);
          li.appendChild(text);
          ul.appendChild(li);
        }

        resultDiv.appendChild(ul);
      }
    }

      // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ä–µ—Ü–µ–ø—Ç–æ–º –∫—Ä–∞—Ñ—Ç–∞
    const modalHistory = [];

    function showCraftModal(craft) {
      if (!craft) return;
      if (!craft.recipe) return; // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –º–æ–¥–∞–ª–∫—É, –µ—Å–ª–∏ —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–µ—Ç
      if (modalHistory.length === 0 || modalHistory[modalHistory.length - 1].id !== craft.id) {
        modalHistory.push(craft);
      }

      modalImg.src = craft.img || 'https://via.placeholder.com/64';
      modalImg.alt = craft.name;
      modalCraft.innerHTML = '';

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ 3x3 —Ä–µ—Ü–µ–ø—Ç–∞
      if (!craft.recipe) {
        modalCraft.textContent = '–†–µ—Ü–µ–ø—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
      } else {
        for (let r = 0; r < 3; r++) {
          for (let c = 0; c < 3; c++) {
            const cell = document.createElement('div');
            cell.className = 'craft-cell';
            const itemId = craft.recipe[r][c];

            if (itemId) {
              const cellCraft = crafts.find(x => x.id === itemId);
              if (cellCraft) {
                const img = document.createElement('img');
                img.src = cellCraft.img || 'https://via.placeholder.com/40';
                img.alt = cellCraft.name;
                img.title = cellCraft.name;
                img.style.cursor = 'pointer';
                img.onclick = () => showCraftModal(cellCraft);
                cell.appendChild(img);
              }
            }

            modalCraft.appendChild(cell);
          }
        }
      }

      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ—É—Ç–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)
      const oldFooter = modalCraft.parentElement.querySelector('.modal-footer');
      if (oldFooter) oldFooter.remove();

      // –°–æ–∑–¥–∞—ë–º —Ñ—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏
      const footer = document.createElement('div');
      footer.className = 'modal-footer';
      footer.style.display = 'flex';
      footer.style.justifyContent = 'space-between';
      footer.style.gap = '12px';
      footer.style.marginTop = '20px';
      footer.style.width = '100%';

      // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
      const backButton = document.createElement('button');
      backButton.textContent = '‚Üê –ù–∞–∑–∞–¥';
      backButton.style.flex = '1';
      backButton.disabled = modalHistory.length <= 1;
      backButton.onclick = () => {
        if (modalHistory.length > 1) {
          modalHistory.pop();
          const previousCraft = modalHistory[modalHistory.length - 1];
          showCraftModal(previousCraft);
        }
      };

      // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å
      const closeButton = document.createElement('button');
      closeButton.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
      closeButton.style.flex = '1';
      closeButton.onclick = () => closeModal();

      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏, –∫–∞–∫ —É .modal-content button
      [backButton, closeButton].forEach(btn => {
        btn.style.backgroundColor = '#ff6b6b';
        btn.style.color = 'white';
        btn.style.border = 'none';
        btn.style.padding = '8px 16px';
        btn.style.borderRadius = '6px';
        btn.style.cursor = 'pointer';
        btn.style.fontWeight = '600';
        btn.style.fontSize = '14px';
        btn.onmouseenter = () => btn.style.backgroundColor = '#ff4d4d';
        btn.onmouseleave = () => btn.style.backgroundColor = '#ff6b6b';
      });

      footer.appendChild(backButton);
      footer.appendChild(closeButton);
      modalCraft.parentElement.appendChild(footer);

      modal.style.display = 'flex';
    }

      function closeModal() {
        modal.style.display = 'none';
      }

      // –ü–æ–∏—Å–∫ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    searchInput.addEventListener('input', () => {
      const val = searchInput.value.toLowerCase();
      renderItemGrid(); // –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ç–∫—É
    });


      function clearSearch() {
        searchInput.value = '';
        autocompleteList.innerHTML = '';
        autocompleteList.hidden = true;
        renderItemGrid();
      }

      // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
      document.addEventListener('click', e => {
        if(!searchInput.contains(e.target) && !autocompleteList.contains(e.target)) {
          autocompleteList.hidden = true;
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      renderItemGrid();
      renderSelectedList();
    </script>

  </body>
  </html>
